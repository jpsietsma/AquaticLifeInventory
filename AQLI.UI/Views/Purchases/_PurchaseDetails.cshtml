@using System.Collections.Generic;
@using AQLI.Data.Models;
@using AQLI.Data.Models.ListModels;
@using AQLI.DataServices;
@using AQLI.DataServices.context;
@using Microsoft.AspNetCore.Mvc;
@using Microsoft.AspNetCore.Http;


@model PurchaseModel;
@inject DataFactory DataSource;
@inject DatabaseContext Database;

<script type="text/javascript">
    $('#PurchaseDescription').focus();
</script>

<div class="modal-dialog modal-dialog-centered modal-lg" role="document">
    <div class="modal-content">
        <div class="modal-header">
            <h5 class="modal-title">
                @(Model.PurchaseID == 0 ? "Create New Purchase | Enter Details" : "Edit Purchase Details | " + Model.Description)
                @if (Model.PurchaseID != 0)
                {
                    <span class="badge bg-@(Model.PurchaseCategory.CategoryColor)">
                        @Model.PurchaseCategory.CategoryName
                    </span>
                }
            </h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
            </button>
        </div>
        <form id="addEditPurchaseForm">
            <div class="modal-body">
                <input id="PurchaseID" type="text" name="PurchaseID" value="@Model.PurchaseID" style="display: none;" />
                <!-- Purchase Description form row -->
                <div class="form-row">
                    <div class="col-12">
                        <div class="form-group">
                            <label class="control-label">Description</label>
                            <input id="PurchaseDescription" type="text" class="form-control" name="Description" placeholder="Enter Purchase Description..." value="@Model.Description" required />
                        </div>
                    </div>
                </div>
                <!-- Quantity, Cost, ExtCost form row -->
                <div class="form-row">
                    <div class="col-3">
                        <div class="form-group">
                            <label class="control-label">Quantity</label>
                            <input id="Quantity" type="number" name="Quantity" class="form-control" value="@Model.Quantity" onchange="Purchases.events.purchaseQuantityOrCost_Changed()" required />
                        </div>
                    </div>
                    <div class="col-3">
                        <div class="form-group">
                            <label class="control-label">Cost</label>
                            <input id="Cost" type="text" class="form-control" name="Cost" value="@Model.Cost" onchange="Purchases.events.purchaseQuantityOrCost_Changed()" required />
                        </div>
                    </div>
                    <div class="col-3">
                        <div class="form-group">
                            <label class="control-label">Ext Cost</label>
                            <input id="ExtCost" type="text" class="form-control" name="ExtCost" value="@Model.ExtCost" disabled />
                        </div>
                    </div>
                    <div class="col-3">
                        <div class="form-group">
                            <label class="control-label">Item Count</label>
                            <input id="PackageCount" type="text" class="form-control" name="PackageCount" value="@Model.PackageCount" />
                        </div>
                    </div>
                </div>
                <!-- Purchase Type, Purchase Category and Owner form row -->
                <div class="form-row">
                    <div class="col-4">
                        <div class="form-group">
                            <label class="control-label">Purchase Type</label>
                            <select id="PurchaseCategoryTypeID" class="form-control" name="PurchaseCategoryTypeID" onchange="Purchases.events.purchaseType_Changed()" required>
                                <option value="0">-- Select Purchase Type --</option>
                                @foreach (PurchaseCategoryTypeModel categoryType in DataSource.List_PurchaseCategoryTypes())
                                {
                                    if (Model.PurchaseCategoryTypeID == categoryType.PurchaseCategoryTypeID)
                                    {
                                        <option selected value="@categoryType.PurchaseCategoryTypeID">@categoryType.PurchaseCategoryTypeName</option>
                                    }
                                    else
                                    {
                                        <option value="@categoryType.PurchaseCategoryTypeID">@categoryType.PurchaseCategoryTypeName</option>
                                    }
                                }
                            </select>
                        </div>
                    </div>
                    <div class="col-4">
                        <div class="form-group">
                            <label class="control-label">Purchase Subtype</label>
                            <select id="PurchaseCategoryID" class="form-control" name="PurchaseCategoryID" required>
                                <option value="0">-- Choose Purchase Type --</option>
                                @foreach (PurchaseCategoryModel category in DataSource.List_PurchaseCategories().OrderBy(p => p.CategoryName))
                                {
                                    if (Model.PurchaseCategoryID == category.PurchaseCategoryID)
                                    {
                                        <option selected value="@category.PurchaseCategoryID" data-categoryType="@category.PurchaseCategoryTypeID">@category.CategoryName</option>
                                    }
                                    else
                                    {
                                        <option value="@category.PurchaseCategoryID" data-categoryType="@category.PurchaseCategoryTypeID">@category.CategoryName</option>
                                    }
                                }
                            </select>
                        </div>
                    </div>
                    <div class="col-4">
                        <div class="form-group">
                            <label class="control-label">Purchase Owner</label>
                            <select class="form-control" name="OwnerID">
                                @foreach (WebsiteUser user in DataSource.List_Users())
                                {
                                    if (Model.OwnerID == user.UserId)
                                    {
                                        <option selected value="@user.UserId">@user.FirstName @user.LastName</option>
                                    }
                                    else
                                    {
                                        <option value="@user.UserId">@user.FirstName @user.LastName</option>
                                    }
                                }
                            </select>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                @if (Model.PurchaseID != 0)
                {
                    <button type="button" data-id="@Model.PurchaseID" class="btn btn-danger sdn-delete-purchase justify-content-start" onclick="Purchases.openConfirmDeleteModal(@Model.PurchaseID)">Delete <i class="fas fa-trash-alt"></i></button>
                }

                @if (Model.PurchaseID == 0)
                {
                    <button id="addToInvoice" type="button" class="btn btn-primary on-new">Add to Invoice <i class="fas fa-plus"></i></button>
                    <button type="button" class="btn btn-success" data-dismiss="modal">Done <i class="fas fa-check"></i></button>
                }
                else
                {
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close </button>
                }
            </div>
        </form>
    </div>
</div>